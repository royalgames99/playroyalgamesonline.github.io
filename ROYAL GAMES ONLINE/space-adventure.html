<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Odyssey: Deep Space Adventure</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Orbitron', sans-serif;
            background-color: #0a0a1a;
            color: #e0e0ff;
            overflow-x: hidden;
        }
        
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Press+Start+2P&display=swap');
        
        #game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            background-image: url('https://images.unsplash.com/photo-1506318137071-a8e063b4bec0?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            overflow: hidden;
        }
        
        #game-ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        #ship {
            position: absolute;
            width: 60px;
            height: 60px;
            background-size: contain;
            background-repeat: no-repeat;
            transition: transform 0.2s ease-out;
            z-index: 5;
        }
        
        .asteroid {
            position: absolute;
            width: 40px;
            height: 40px;
            background-size: contain;
            background-repeat: no-repeat;
            z-index: 4;
        }
        
        .planet {
            position: absolute;
            border-radius: 50%;
            z-index: 3;
            background-size: cover;
            background-position: center;
        }
        
        #hud {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: rgba(0, 0, 30, 0.7);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #00a2ff;
        }
        
        #mission-log {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 300px;
            height: 150px;
            background-color: rgba(0, 0, 30, 0.7);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #00a2ff;
            overflow-y: auto;
            font-size: 12px;
        }
        
        #resources {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(0, 0, 30, 0.7);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #00a2ff;
            text-align: right;
        }
        
        #mission-control {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background-color: rgba(0, 0, 30, 0.7);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #00a2ff;
            width: 200px;
        }
        
        button {
            background-color: #003366;
            color: #e0e0ff;
            border: 1px solid #00a2ff;
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            pointer-events: auto;
        }
        
        button:hover {
            background-color: #004488;
        }
        
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 20, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
        }
        
        #start-screen h1 {
            font-size: 3em;
            color: #00a2ff;
            text-shadow: 0 0 10px #00a2ff;
            margin-bottom: 20px;
        }
        
        #start-screen p {
            max-width: 600px;
            text-align: center;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        #start-button {
            padding: 15px 30px;
            font-size: 1.2em;
            background-color: #004488;
        }
        
        #restart-button {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            z-index: 25;
            display: none;
        }
        
        .alert {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 20, 40, 0.9);
            padding: 20px;
            border-radius: 5px;
            border: 2px solid #ff5555;
            z-index: 15;
            text-align: center;
            display: none;
        }
        
        .alert button {
            margin-top: 15px;
        }
        
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            z-index: 1;
        }
        
        .fuel-pickup {
            position: absolute;
            width: 30px;
            height: 30px;
            background-image: url('https://cdn-icons-png.flaticon.com/512/3293/3293471.png');
            background-size: contain;
            z-index: 4;
        }
        
        .black-hole {
            position: absolute;
            width: 80px;
            height: 80px;
            background-size: contain;
            z-index: 6;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        footer {
            background-color: #000033;
            color: #e0e0ff;
            padding: 20px;
            text-align: center;
            font-family: 'Orbitron', sans-serif;
            border-top: 1px solid #00a2ff;
        }
        
        .donation-appeal {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: rgba(0, 20, 40, 0.7);
            border-radius: 8px;
            border: 1px solid #00a2ff;
        }
        
        .donation-appeal h3 {
            color: #00a2ff;
            margin-top: 0;
        }
        
        .progress-bar {
            height: 20px;
            background-color: #003366;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: #00a2ff;
            width: 0%;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Stars background -->
        <div id="stars"></div>
        
        <!-- Player ship -->
        <div id="ship"></div>
        
        <!-- Game UI elements -->
        <div id="game-ui">
            <div id="hud">
                <h2>Cosmic Odyssey</h2>
                <div>Health: <span id="health">100%</span></div>
                <div>Fuel: <span id="fuel">100%</span></div>
                <div>Shields: <span id="shields">100%</span></div>
                <div>Speed: <span id="speed">0</span> km/s</div>
            </div>
            
            <div id="resources">
                <div>Credits: <span id="credits">500</span></div>
                <div>Energy Crystals: <span id="crystals">0</span></div>
                <div>Rare Metals: <span id="metals">0</span></div>
            </div>
            
            <div id="mission-log">
                <h3>Mission Log</h3>
                <div id="log-entries"></div>
            </div>
            
            <div id="mission-control">
                <h3>Mission Control</h3>
                <button id="repair-btn">Repair Ship (100 credits)</button>
                <button id="refuel-btn">Refuel (50 credits)</button>
                <button id="upgrade-btn">Upgrade Shields (200 credits)</button>
                <div class="progress-bar">
                    <div class="progress" id="mission-progress"></div>
                </div>
                <div>Mission: <span id="current-mission">Explore the asteroid belt</span></div>
            </div>
        </div>
        
        <!-- Restart button -->
        <button id="restart-button">RESTART MISSION</button>
        
        <!-- Start screen -->
        <div id="start-screen">
            <h1>COSMIC ODYSSEY</h1>
            <p>Embark on an epic space adventure across the galaxy! Navigate asteroid fields, explore mysterious planets, 
                mine valuable resources, and survive cosmic hazards in this realistic space simulation.</p>
            <p>Features:</p>
            <ul style="text-align: left;">
                <li>Realistic orbital mechanics</li>
                <li>Dynamic resource management</li>
                <li>Procedurally generated challenges</li>
                <li>Multiple mission objectives</li>
                <li>Upgradable ship systems</li>
            </ul>
            <button id="start-button">BEGIN MISSION</button>
        </div>
        
        <!-- Alert messages -->
        <div class="alert" id="game-over-alert">
            <h2>MISSION FAILED</h2>
            <p>Your ship has been destroyed or stranded in space.</p>
            <button id="restart-btn">Try Again</button>
        </div>
        
        <div class="alert" id="mission-complete-alert">
            <h2>MISSION ACCOMPLISHED</h2>
            <p id="mission-reward-text">You've successfully completed your objective!</p>
            <button id="next-mission-btn">Accept Next Mission</button>
        </div>
    </div>
    
    <footer>
        <div class="donation-appeal">
            <h3>Support Our Gaming Startup!</h3>
            <p>Enjoying the game? Help us create more high-quality games by donating to our gaming fund.</p>
            <form>
                <script src="https://checkout.razorpay.com/v1/payment-button.js" 
                        data-payment_button_id="pl_QuCtRHhHzRgOgT" 
                        async>
                </script>
            </form>
        </div>
    </footer>
    
    <script>
        // Game variables
        let gameActive = false;
        let health = 100;
        let fuel = 100;
        let shields = 100;
        let speed = 0;
        let credits = 500;
        let crystals = 0;
        let metals = 0;
        let missionProgress = 0;
        let currentMission = 1;
        let shipX = 0;
        let shipY = 0;
        let shipAngle = 0;
        let keys = {};
        let asteroids = [];
        let planets = [];
        let fuelPickups = [];
        let blackHoles = [];
        
        // Image URLs
        const shipImage = 'space games asset/spaceship.png';
        const planetImages = [
            'space games asset/pl3.png',
            'space games asset/pl1.png'
            
        ];
        const asteroidImage = 'space games asset/asteroid 2.png';
        const blackHoleImage = 'space games asset/bhole.png';
        
        // DOM elements
        const ship = document.getElementById('ship');
        const gameContainer = document.getElementById('game-container');
        const startScreen = document.getElementById('start-screen');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        const gameOverAlert = document.getElementById('game-over-alert');
        const missionCompleteAlert = document.getElementById('mission-complete-alert');
        const restartBtn = document.getElementById('restart-btn');
        const nextMissionBtn = document.getElementById('next-mission-btn');
        const healthDisplay = document.getElementById('health');
        const fuelDisplay = document.getElementById('fuel');
        const shieldsDisplay = document.getElementById('shields');
        const speedDisplay = document.getElementById('speed');
        const creditsDisplay = document.getElementById('credits');
        const crystalsDisplay = document.getElementById('crystals');
        const metalsDisplay = document.getElementById('metals');
        const missionProgressBar = document.getElementById('mission-progress');
        const currentMissionDisplay = document.getElementById('current-mission');
        const logEntries = document.getElementById('log-entries');
        const repairBtn = document.getElementById('repair-btn');
        const refuelBtn = document.getElementById('refuel-btn');
        const upgradeBtn = document.getElementById('upgrade-btn');
        
        // Mission objectives
        const missions = [
            { 
                title: "Explore the asteroid belt", 
                description: "Navigate through the asteroid belt and collect 3 energy crystals", 
                target: 3, 
                resource: "crystals",
                reward: 200
            },
            { 
                title: "Mine rare metals", 
                description: "Collect 5 units of rare metals from asteroids", 
                target: 5, 
                resource: "metals",
                reward: 300
            },
            { 
                title: "Survey planetary system", 
                description: "Visit 3 planets in the system", 
                target: 3, 
                resource: "planets",
                reward: 400
            },
            { 
                title: "Black hole research", 
                description: "Approach 2 black holes for scientific study (carefully!)", 
                target: 2, 
                resource: "blackholes",
                reward: 500
            },
            { 
                title: "Final challenge", 
                description: "Collect 5 energy crystals and 5 rare metals", 
                target: 5, 
                resource: "both",
                reward: 1000
            }
        ];
        
        // Initialize game
        function initGame() {
            // Set ship image
            ship.style.backgroundImage = `url('${shipImage}')`;
            
            // Set initial ship position
            shipX = window.innerWidth / 2;
            shipY = window.innerHeight / 2;
            updateShipPosition();
            
            // Create stars
            createStars();
            
            // Generate initial asteroids
            generateAsteroids(15);
            
            // Generate planets
            generatePlanets(3);
            
            // Generate fuel pickups
            generateFuelPickups(3);
            
            // Generate black holes
            generateBlackHoles(2);
            
            // Start mission
            updateMissionDisplay();
            
            // Event listeners
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);
            startButton.addEventListener('click', startGame);
            restartButton.addEventListener('click', restartGame);
            restartBtn.addEventListener('click', restartGame);
            nextMissionBtn.addEventListener('click', startNextMission);
            repairBtn.addEventListener('click', repairShip);
            refuelBtn.addEventListener('click', refuelShip);
            upgradeBtn.addEventListener('click', upgradeShields);
            
            // Start game loop
            gameLoop();
        }
        
        // Game loop
        function gameLoop() {
            if (gameActive) {
                // Handle ship movement
                handleMovement();
                
                // Check collisions
                checkCollisions();
                
                // Update resources
                updateResources();
                
                // Random events
                if (Math.random() < 0.01) {
                    randomEvent();
                }
                
                // Check mission progress
                checkMissionProgress();
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        // Start game
        function startGame() {
            gameActive = true;
            startScreen.style.display = 'none';
            restartButton.style.display = 'block';
            addLogEntry("Mission started. Good luck, Commander!");
        }
        
        // Restart game
        function restartGame() {
            // Reset game state
            health = 100;
            fuel = 100;
            shields = 100;
            speed = 0;
            credits = 500;
            crystals = 0;
            metals = 0;
            missionProgress = 0;
            currentMission = 1;
            
            // Clear existing objects
            clearGameObjects();
            
            // Regenerate objects
            generateAsteroids(15);
            generatePlanets(3);
            generateFuelPickups(3);
            generateBlackHoles(2);
            
            // Update displays
            updateDisplays();
            updateMissionDisplay();
            
            // Hide alerts
            gameOverAlert.style.display = 'none';
            missionCompleteAlert.style.display = 'none';
            
            // Reset ship position
            shipX = window.innerWidth / 2;
            shipY = window.innerHeight / 2;
            updateShipPosition();
            
            // Activate game
            gameActive = true;
            restartButton.style.display = 'block';
            
            // Add log entry
            addLogEntry("Mission restarted. Let's try again!");
        }
        
        // Start next mission
        function startNextMission() {
            currentMission++;
            missionProgress = 0;
            
            // Clear existing objects
            clearGameObjects();
            
            // Generate more challenging objects
            generateAsteroids(15 + currentMission * 3);
            generatePlanets(3 + Math.floor(currentMission / 2));
            generateFuelPickups(3);
            generateBlackHoles(2 + Math.floor(currentMission / 3));
            
            // Update mission display
            updateMissionDisplay();
            
            // Hide mission complete alert
            missionCompleteAlert.style.display = 'none';
            
            // Activate game
            gameActive = true;
            restartButton.style.display = 'block';
            
            // Add log entry
            addLogEntry("Mission " + currentMission + " initiated: " + missions[currentMission-1].description);
        }
        
        // Create stars background
        function createStars() {
            const starsContainer = document.getElementById('stars');
            starsContainer.innerHTML = '';
            
            for (let i = 0; i < 200; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                // Random position
                const x = Math.random() * window.innerWidth;
                const y = Math.random() * window.innerHeight;
                
                // Random size
                const size = Math.random() * 2;
                
                // Random opacity
                const opacity = Math.random();
                
                star.style.left = x + 'px';
                star.style.top = y + 'px';
                star.style.width = size + 'px';
                star.style.height = size + 'px';
                star.style.opacity = opacity;
                
                starsContainer.appendChild(star);
            }
        }
        
        // Generate asteroids
        function generateAsteroids(count) {
            for (let i = 0; i < count; i++) {
                const asteroid = document.createElement('div');
                asteroid.className = 'asteroid';
                asteroid.style.backgroundImage = `url('${asteroidImage}')`;
                
                // Random position (not too close to ship)
                let x, y;
                do {
                    x = Math.random() * (window.innerWidth - 100) + 50;
                    y = Math.random() * (window.innerHeight - 100) + 50;
                } while (Math.abs(x - shipX) < 150 && Math.abs(y - shipY) < 150);
                
                // Random rotation
                const rotation = Math.random() * 360;
                
                // Random speed
                const xSpeed = (Math.random() - 0.5) * 2;
                const ySpeed = (Math.random() - 0.5) * 2;
                
                asteroid.style.left = x + 'px';
                asteroid.style.top = y + 'px';
                asteroid.style.transform = `rotate(${rotation}deg)`;
                asteroid.dataset.xSpeed = xSpeed;
                asteroid.dataset.ySpeed = ySpeed;
                
                gameContainer.appendChild(asteroid);
                asteroids.push(asteroid);
            }
        }
        
        // Generate planets
        function generatePlanets(count) {
            for (let i = 0; i < count; i++) {
                const planet = document.createElement('div');
                planet.className = 'planet';
                
                // Random planet image
                const planetImage = planetImages[Math.floor(Math.random() * planetImages.length)];
                planet.style.backgroundImage = `url('${planetImage}')`;
                
                // Random position
                const x = Math.random() * (window.innerWidth - 200) + 100;
                const y = Math.random() * (window.innerHeight - 200) + 100;
                
                // Random size
                const size = Math.random() * 100 + 50;
                
                planet.style.left = x + 'px';
                planet.style.top = y + 'px';
                planet.style.width = size + 'px';
                planet.style.height = size + 'px';
                
                // Add rings to some planets
                if (Math.random() > 0.7) {
                    planet.style.boxShadow = `0 0 10px 5px rgba(200, 200, 255, 0.5)`;
                }
                
                gameContainer.appendChild(planet);
                planets.push(planet);
            }
        }
        
        // Generate fuel pickups
        function generateFuelPickups(count) {
            for (let i = 0; i < count; i++) {
                const fuel = document.createElement('div');
                fuel.className = 'fuel-pickup';
                
                // Random position
                const x = Math.random() * (window.innerWidth - 50) + 25;
                const y = Math.random() * (window.innerHeight - 50) + 25;
                
                fuel.style.left = x + 'px';
                fuel.style.top = y + 'px';
                
                gameContainer.appendChild(fuel);
                fuelPickups.push(fuel);
            }
        }
        
        // Generate black holes
        function generateBlackHoles(count) {
            for (let i = 0; i < count; i++) {
                const blackHole = document.createElement('div');
                blackHole.className = 'black-hole';
                blackHole.style.backgroundImage = `url('${blackHoleImage}')`;
                
                // Random position (not too close to ship)
                let x, y;
                do {
                    x = Math.random() * (window.innerWidth - 100) + 50;
                    y = Math.random() * (window.innerHeight - 100) + 50;
                } while (Math.abs(x - shipX) < 200 && Math.abs(y - shipY) < 200);
                
                blackHole.style.left = x + 'px';
                blackHole.style.top = y + 'px';
                
                gameContainer.appendChild(blackHole);
                blackHoles.push(blackHole);
            }
        }
        
        // Clear game objects
        function clearGameObjects() {
            asteroids.forEach(asteroid => asteroid.remove());
            planets.forEach(planet => planet.remove());
            fuelPickups.forEach(fuel => fuel.remove());
            blackHoles.forEach(blackHole => blackHole.remove());
            
            asteroids = [];
            planets = [];
            fuelPickups = [];
            blackHoles = [];
        }
        
        // Handle keyboard input
        function handleKeyDown(e) {
            keys[e.key] = true;
        }
        
        function handleKeyUp(e) {
            keys[e.key] = false;
        }
        
        // Handle ship movement
        function handleMovement() {
            // Rotate ship
            if (keys['ArrowLeft'] || keys['a']) {
                shipAngle -= 5;
            }
            if (keys['ArrowRight'] || keys['d']) {
                shipAngle += 5;
            }
            
            // Thrust
            if ((keys['ArrowUp'] || keys['w']) && fuel > 0) {
                const radians = shipAngle * Math.PI / 180;
                const thrust = 0.5;
                
                speed += thrust;
                if (speed > 10) speed = 10;
                
                // Calculate movement vector
                const moveX = Math.sin(radians) * thrust;
                const moveY = -Math.cos(radians) * thrust;
                
                shipX += moveX * speed;
                shipY += moveY * speed;
                
                // Consume fuel
                fuel -= 0.1;
                if (fuel < 0) fuel = 0;
            } else {
                // Slow down
                speed *= 0.98;
                if (speed < 0.1) speed = 0;
            }
            
            // Apply movement
            shipX += Math.sin(shipAngle * Math.PI / 180) * speed;
            shipY += -Math.cos(shipAngle * Math.PI / 180) * speed;
            
            // Boundary checks
            if (shipX < 0) shipX = 0;
            if (shipX > window.innerWidth) shipX = window.innerWidth;
            if (shipY < 0) shipY = 0;
            if (shipY > window.innerHeight) shipY = window.innerHeight;
            
            // Update ship position and rotation
            updateShipPosition();
            
            // Move asteroids
            moveAsteroids();
            
            // Update displays
            updateDisplays();
        }
        
        // Update ship position and rotation
        function updateShipPosition() {
            ship.style.left = (shipX - 30) + 'px';
            ship.style.top = (shipY - 30) + 'px';
            ship.style.transform = `rotate(${shipAngle}deg)`;
        }
        
        // Move asteroids
        function moveAsteroids() {
            asteroids.forEach(asteroid => {
                let x = parseFloat(asteroid.style.left);
                let y = parseFloat(asteroid.style.top);
                const xSpeed = parseFloat(asteroid.dataset.xSpeed);
                const ySpeed = parseFloat(asteroid.dataset.ySpeed);
                
                x += xSpeed;
                y += ySpeed;
                
                // Boundary checks with wrap-around
                if (x < -50) x = window.innerWidth;
                if (x > window.innerWidth) x = -50;
                if (y < -50) y = window.innerHeight;
                if (y > window.innerHeight) y = -50;
                
                asteroid.style.left = x + 'px';
                asteroid.style.top = y + 'px';
            });
        }
        
        // Update displays
        function updateDisplays() {
            healthDisplay.textContent = Math.floor(health) + '%';
            fuelDisplay.textContent = Math.floor(fuel) + '%';
            shieldsDisplay.textContent = Math.floor(shields) + '%';
            speedDisplay.textContent = Math.floor(speed * 100);
            creditsDisplay.textContent = credits;
            crystalsDisplay.textContent = crystals;
            metalsDisplay.textContent = metals;
            
            // Update mission progress bar
            const mission = missions[currentMission-1];
            const progressPercent = (missionProgress / mission.target) * 100;
            missionProgressBar.style.width = progressPercent + '%';
            
            // Disable buttons if not enough credits
            repairBtn.disabled = credits < 100;
            refuelBtn.disabled = credits < 50;
            upgradeBtn.disabled = credits < 200;
        }
        
        // Update mission display
        function updateMissionDisplay() {
            if (currentMission <= missions.length) {
                currentMissionDisplay.textContent = missions[currentMission-1].title + ": " + missions[currentMission-1].description;
            } else {
                currentMissionDisplay.textContent = "All missions completed!";
            }
        }
        
        // Check collisions
        function checkCollisions() {
            // Check asteroid collisions
            asteroids.forEach(asteroid => {
                const asteroidRect = asteroid.getBoundingClientRect();
                const shipRect = ship.getBoundingClientRect();
                
                if (checkCollision(asteroidRect, shipRect)) {
                    // Calculate damage based on speed
                    const damage = speed * 5;
                    takeDamage(damage);
                    
                    // Bounce off
                    speed *= -0.5;
                    
                    // Small chance to mine resources
                    if (Math.random() < 0.3) {
                        if (Math.random() < 0.5) {
                            crystals++;
                            addLogEntry("Mined 1 energy crystal from asteroid");
                        } else {
                            metals++;
                            addLogEntry("Mined 1 unit of rare metals from asteroid");
                        }
                    }
                    
                    // Remove asteroid
                    asteroid.remove();
                    asteroids = asteroids.filter(a => a !== asteroid);
                    
                    // Add new asteroid
                    generateAsteroids(1);
                }
            });
            
            // Check planet gravity
            planets.forEach(planet => {
                const planetRect = planet.getBoundingClientRect();
                const planetX = planetRect.left + planetRect.width / 2;
                const planetY = planetRect.top + planetRect.height / 2;
                
                const distance = Math.sqrt(Math.pow(planetX - shipX, 2) + Math.pow(planetY - shipY, 2));
                const gravityRadius = planetRect.width * 1.5;
                
                if (distance < gravityRadius) {
                    // Apply gravity
                    const gravity = (1 - distance / gravityRadius) * 0.5;
                    const angle = Math.atan2(planetY - shipY, planetX - shipX);
                    
                    shipX += Math.cos(angle) * gravity;
                    shipY += Math.sin(angle) * gravity;
                    
                    // If too close, take damage
                    if (distance < planetRect.width / 2) {
                        takeDamage(2);
                    }
                    
                    // Check if this counts for mission progress
                    if (!planet.dataset.visited && currentMission <= missions.length && 
                        missions[currentMission-1].resource === "planets") {
                        planet.dataset.visited = true;
                        missionProgress++;
                        addLogEntry("Planet surveyed! " + missionProgress + "/" + missions[currentMission-1].target + " completed");
                    }
                }
            });
            
            // Check fuel pickups
            fuelPickups.forEach(fuelPickup => {
                const fuelRect = fuelPickup.getBoundingClientRect();
                const shipRect = ship.getBoundingClientRect();
                
                if (checkCollision(fuelRect, shipRect)) {
                    fuel = Math.min(100, fuel + 30);
                    addLogEntry("Collected fuel (+30%)");
                    
                    // Remove fuel pickup
                    fuelPickup.remove();
                    fuelPickups = fuelPickups.filter(f => f !== fuelPickup);
                    
                    // Add new fuel pickup
                    generateFuelPickups(1);
                }
            });
            
            // Check black holes
            blackHoles.forEach(blackHole => {
                const blackHoleRect = blackHole.getBoundingClientRect();
                const shipRect = ship.getBoundingClientRect();
                const distance = Math.sqrt(
                    Math.pow(blackHoleRect.left + blackHoleRect.width/2 - (shipRect.left + shipRect.width/2), 2) +
                    Math.pow(blackHoleRect.top + blackHoleRect.height/2 - (shipRect.top + shipRect.height/2), 2)
                );
                
                // Gravitational pull
                if (distance < 200) {
                    const pullStrength = (1 - distance/200) * 5;
                    const angle = Math.atan2(
                        blackHoleRect.top + blackHoleRect.height/2 - (shipRect.top + shipRect.height/2),
                        blackHoleRect.left + blackHoleRect.width/2 - (shipRect.left + shipRect.width/2)
                    );
                    
                    shipX += Math.cos(angle) * pullStrength;
                    shipY += Math.sin(angle) * pullStrength;
                    
                    // Damage if too close
                    if (distance < 50) {
                        takeDamage(5);
                        
                        // Check if this counts for mission progress
                        if (!blackHole.dataset.visited && currentMission <= missions.length && 
                            missions[currentMission-1].resource === "blackholes") {
                            blackHole.dataset.visited = true;
                            missionProgress++;
                            addLogEntry("Black hole studied! " + missionProgress + "/" + missions[currentMission-1].target + " completed");
                        }
                    }
                }
            });
        }
        
        // Check collision between two rectangles
        function checkCollision(rect1, rect2) {
            return !(
                rect1.right < rect2.left || 
                rect1.left > rect2.right || 
                rect1.bottom < rect2.top || 
                rect1.top > rect2.bottom
            );
        }
        
        // Take damage
        function takeDamage(amount) {
            // Shields absorb damage first
            const shieldDamage = Math.min(shields, amount);
            shields -= shieldDamage;
            amount -= shieldDamage;
            
            // Remaining damage goes to health
            if (amount > 0) {
                health -= amount;
                
                // Check for game over
                if (health <= 0) {
                    health = 0;
                    gameOver();
                }
            }
            
            // Update displays
            updateDisplays();
        }
        
        // Game over
        function gameOver() {
            gameActive = false;
            restartButton.style.display = 'none';
            gameOverAlert.style.display = 'block';
            addLogEntry("Mission failed...");
        }
        
        // Update resources
        function updateResources() {
            // Fuel consumption
            if (speed > 0) {
                fuel -= 0.02;
                if (fuel <= 0) {
                    fuel = 0;
                    speed *= 0.98; // Slow down when out of fuel
                    
                    // Chance of stranding
                    if (Math.random() < 0.005) {
                        addLogEntry("Warning: Stranded without fuel!");
                        takeDamage(0.5); // Slow damage when stranded
                    }
                }
            }
            
            // Shield recharge
            if (shields < 100 && Math.random() < 0.02) {
                shields += 0.5;
                if (shields > 100) shields = 100;
            }
        }
        
        // Random events
        function randomEvent() {
            const events = [
                { 
                    message: "Solar flare detected! Taking minor damage.", 
                    effect: () => takeDamage(5) 
                },
                { 
                    message: "Cosmic radiation spike. Shields weakened.", 
                    effect: () => shields *= 0.8 
                },
                { 
                    message: "Found drifting cargo. +50 credits.", 
                    effect: () => credits += 50 
                },
                { 
                    message: "Engine malfunction! Speed reduced temporarily.", 
                    effect: () => speed *= 0.5 
                },
                { 
                    message: "Fuel leak detected!", 
                    effect: () => fuel *= 0.9 
                }
            ];
            
            const event = events[Math.floor(Math.random() * events.length)];
            addLogEntry(event.message);
            event.effect();
        }
        
        // Check mission progress
        function checkMissionProgress() {
            if (currentMission > missions.length) return;
            
            const mission = missions[currentMission-1];
            let completed = false;
            
            if (mission.resource === "crystals" && crystals >= mission.target) {
                completed = true;
            } else if (mission.resource === "metals" && metals >= mission.target) {
                completed = true;
            } else if (mission.resource === "both" && crystals >= mission.target && metals >= mission.target) {
                completed = true;
            } else if ((mission.resource === "planets" || mission.resource === "blackholes") && 
                      missionProgress >= mission.target) {
                completed = true;
            }
            
            if (completed) {
                // Mission complete!
                credits += mission.reward;
                
                if (currentMission < missions.length) {
                    missionCompleteAlert.style.display = 'block';
                    document.getElementById('mission-reward-text').textContent = 
                        `Mission complete! Reward: ${mission.reward} credits. Ready for next challenge?`;
                } else {
                    missionCompleteAlert.style.display = 'block';
                    document.getElementById('mission-reward-text').textContent = 
                        `All missions completed! Final reward: ${mission.reward} credits. Congratulations!`;
                    nextMissionBtn.textContent = "Play Again";
                }
                
                gameActive = false;
                restartButton.style.display = 'none';
            }
        }
        
        // Add log entry
        function addLogEntry(text) {
            const entry = document.createElement('div');
            entry.textContent = "> " + text;
            logEntries.appendChild(entry);
            logEntries.scrollTop = logEntries.scrollHeight;
        }
        
        // Repair ship
        function repairShip() {
            if (credits >= 100 && health < 100) {
                credits -= 100;
                health = Math.min(100, health + 30);
                addLogEntry("Ship repaired (+30% health)");
                updateDisplays();
            }
        }
        
        // Refuel ship
        function refuelShip() {
            if (credits >= 50 && fuel < 100) {
                credits -= 50;
                fuel = Math.min(100, fuel + 50);
                addLogEntry("Ship refueled (+50% fuel)");
                updateDisplays();
            }
        }
        
        // Upgrade shields
        function upgradeShields() {
            if (credits >= 200) {
                credits -= 200;
                shields = Math.min(150, shields + 50); // Allow overcharge to 150%
                addLogEntry("Shields upgraded (+50% capacity)");
                updateDisplays();
            }
        }
        
        // Initialize game when loaded
        window.onload = initGame;
    </script>
</body>
</html>